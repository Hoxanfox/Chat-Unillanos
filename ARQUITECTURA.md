# ğŸ—ï¸ Arquitectura del Sistema Chat-Unillanos

## VisiÃ³n General

Chat-Unillanos estÃ¡ diseÃ±ado con una **arquitectura cliente-servidor** utilizando comunicaciÃ³n TCP/IP con Netty y sockets Java.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SISTEMA CHAT-UNILLANOS                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLIENTE 1     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
â”‚   (JavaFX)      â”‚         TCP/IP             â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         JSON               â”‚                 â”‚
                                                â”‚    SERVIDOR     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚    (Netty)      â”‚
â”‚   CLIENTE 2     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
â”‚   (JavaFX)      â”‚    Puerto 8888             â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚                 â”‚
                                                â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚                 â”‚
â”‚   CLIENTE N     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
â”‚   (JavaFX)      â”‚                            â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Arquitectura del Cliente

El cliente sigue una **arquitectura en capas** con separaciÃ³n de responsabilidades:

### Diagrama de Capas

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    CAPA DE PRESENTACIÃ“N                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚   Vistas     â”‚  â”‚ Controladoresâ”‚  â”‚   Main (Entry)    â”‚   â•‘
â•‘  â”‚  (JavaFX)    â”‚â—„â”€â”¤     (MVC)    â”‚  â”‚                   â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â”‚
                            â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     CAPA DE NEGOCIO                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚  Servicios   â”‚  â”‚   Fachadas   â”‚  â”‚    GestiÃ³n de     â”‚   â•‘
â•‘  â”‚              â”‚  â”‚              â”‚  â”‚  Usuarios/Contactosâ”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚           ComunicaciÃ³n (EnviadorPeticiones,          â”‚     â•‘
â•‘  â”‚              GestorRespuesta - Observer)             â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â”‚
                            â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   CAPA DE PERSISTENCIA                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚   ConexiÃ³n   â”‚  â”‚  Transporte  â”‚  â”‚     Dominio       â”‚   â•‘
â•‘  â”‚  (Singleton) â”‚  â”‚    (TCP)     â”‚  â”‚                   â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â”‚
                            â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  CAPA DE INFRAESTRUCTURA                      â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚     DTOs     â”‚  â”‚  Observador  â”‚  â”‚     Logger        â”‚   â•‘
â•‘  â”‚              â”‚  â”‚   (Pattern)  â”‚  â”‚                   â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Flujo de una PeticiÃ³n (Ejemplo: Login)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vista   â”‚â”€â”€â”€â”€â–ºâ”‚  Controlador  â”‚â”€â”€â”€â”€â–ºâ”‚ Servicio â”‚â”€â”€â”€â”€â–ºâ”‚  GestiÃ³n    â”‚
â”‚  Login   â”‚     â”‚ AutenticaciÃ³n â”‚     â”‚  Auth    â”‚     â”‚  Usuario    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                                                           â”‚
     â”‚                                                           â–¼
     â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                  â”‚  ComunicaciÃ³n   â”‚
     â”‚                                                  â”‚  (Enviador)     â”‚
     â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                           â”‚
     â”‚                                                           â–¼
     â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                  â”‚    Transporte   â”‚
     â”‚                                                  â”‚      (TCP)      â”‚
     â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                           â”‚
     â”‚                                                           â–¼
     â”‚                                                   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•‘   SERVIDOR    â•‘
           CompletableFuture (respuesta asÃ­ncrona)      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Patrones de DiseÃ±o Implementados

| PatrÃ³n | UbicaciÃ³n | PropÃ³sito |
|--------|-----------|-----------|
| **MVC** | PresentaciÃ³n | Separar vista, controlador y lÃ³gica |
| **DTO** | Infraestructura | Transferencia de datos entre capas |
| **Singleton** | GestorConexion | Una Ãºnica instancia de sesiÃ³n |
| **Observer** | GestionContactos | Notificar cambios en la lista |
| **Fachada** | Negocio | Simplificar interfaces complejas |
| **Factory** | TransporteTCP | CreaciÃ³n de conexiones |
| **Repository** | Persistencia | AbstracciÃ³n del acceso a datos |

---

## Arquitectura del Servidor

El servidor utiliza **Netty** para manejar conexiones TCP de forma eficiente y escalable.

### Pipeline de Netty

```
Cliente                    Servidor Netty
  â”‚
  â”‚  "{"action":"authenticateUser",...}\n"
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              EventLoop (NioEventLoopGroup)              â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚          Pipeline de ChannelHandlers           â”‚     â”‚
â”‚  â”‚                                                 â”‚     â”‚
â”‚  â”‚  1. LineBasedFrameDecoder                      â”‚     â”‚
â”‚  â”‚     â”œâ”€â–º Separa mensajes por '\n'               â”‚     â”‚
â”‚  â”‚                                                 â”‚     â”‚
â”‚  â”‚  2. StringDecoder                              â”‚     â”‚
â”‚  â”‚     â”œâ”€â–º Convierte bytes a String (UTF-8)       â”‚     â”‚
â”‚  â”‚                                                 â”‚     â”‚
â”‚  â”‚  3. StringEncoder                              â”‚     â”‚
â”‚  â”‚     â”œâ”€â–º Convierte String a bytes (UTF-8)       â”‚     â”‚
â”‚  â”‚                                                 â”‚     â”‚
â”‚  â”‚  4. ManejadorCliente                           â”‚     â”‚
â”‚  â”‚     â”œâ”€â–º Procesa JSON                           â”‚     â”‚
â”‚  â”‚     â”œâ”€â–º Invoca GestorSesiones                  â”‚     â”‚
â”‚  â”‚     â””â”€â–º EnvÃ­a respuestas                       â”‚     â”‚
â”‚  â”‚                                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Componentes del Servidor

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Main.java                            â”‚
â”‚              (Punto de entrada del servidor)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ServidorNetty.java                        â”‚
â”‚         (ConfiguraciÃ³n de Bootstrap y Pipeline)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ManejadorCliente.java                       â”‚
â”‚        (Procesa peticiones y envÃ­a respuestas)              â”‚
â”‚                                                              â”‚
â”‚  â€¢ channelActive()     â†’ Nuevo cliente conectado            â”‚
â”‚  â€¢ channelRead0()      â†’ Procesa mensaje JSON               â”‚
â”‚  â€¢ channelInactive()   â†’ Cliente desconectado               â”‚
â”‚                                                              â”‚
â”‚  Acciones soportadas:                                       â”‚
â”‚    - authenticateUser                                       â”‚
â”‚    - solicitarListaContactos                                â”‚
â”‚    - enviarMensaje (bÃ¡sico)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 GestorSesiones.java                         â”‚
â”‚         (Singleton - Gestiona usuarios conectados)          â”‚
â”‚                                                              â”‚
â”‚  â€¢ ChannelGroup canalesActivos                              â”‚
â”‚  â€¢ Map<Channel, String> usuariosPorCanal                    â”‚
â”‚  â€¢ Map<String, Channel> canalesPorUsuario                   â”‚
â”‚                                                              â”‚
â”‚  MÃ©todos:                                                    â”‚
â”‚    - registrarCanal()                                       â”‚
â”‚    - autenticarUsuario()                                    â”‚
â”‚    - removerCanal()                                         â”‚
â”‚    - obtenerContactos()                                     â”‚
â”‚    - difundirAAutenticados()                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Protocolo de ComunicaciÃ³n

### Formato de Mensajes

Todos los mensajes siguen el formato **Line-Based**: JSON seguido de `\n`

#### Estructura de DTORequest (Cliente â†’ Servidor)

```json
{
  "action": "nombreAccion",
  "payload": { 
    // Datos especÃ­ficos de la acciÃ³n
  }
}
```

#### Estructura de DTOResponse (Servidor â†’ Cliente)

```json
{
  "action": "nombreAccion",
  "status": "success|error",
  "message": "Mensaje descriptivo",
  "data": { 
    // Datos de respuesta (opcional)
  }
}
```

### Secuencia de ComunicaciÃ³n

#### 1. ConexiÃ³n y AutenticaciÃ³n

```sequence
Cliente                         Servidor
   â”‚                               â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€ ConexiÃ³n TCP â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                               â”‚
   â”‚â—„â”€â”€â”€â”€ Socket aceptado â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                               â”‚
   â”‚                               â”‚ (GestorRespuesta
   â”‚                               â”‚  inicia hilo de escucha)
   â”‚                               â”‚
   â”‚â”€â”€â”€ DTORequest â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚   (authenticateUser)          â”‚
   â”‚                               â”‚
   â”‚                               â”‚ (Valida y registra usuario)
   â”‚                               â”‚
   â”‚â—„â”€â”€ DTOResponse â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚   (success/error)             â”‚
   â”‚                               â”‚
   â”‚                               â”‚ (Difunde actualizaciÃ³n
   â”‚â—„â”€â”€ DTOResponse â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  de contactos a todos)
   â”‚   (actualizarListaContactos)  â”‚
   â”‚                               â”‚
```

#### 2. Solicitud de Contactos

```sequence
Cliente                         Servidor
   â”‚                               â”‚
   â”‚â”€â”€â”€ DTORequest â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚   (solicitarListaContactos)   â”‚
   â”‚                               â”‚
   â”‚                               â”‚ (Obtiene lista de
   â”‚                               â”‚  usuarios conectados)
   â”‚                               â”‚
   â”‚â—„â”€â”€ DTOResponse â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚   (actualizarListaContactos)  â”‚
   â”‚   data: [DTOContacto...]      â”‚
   â”‚                               â”‚
```

#### 3. DesconexiÃ³n de Usuario

```sequence
Cliente 1  Cliente 2  Cliente N        Servidor
   â”‚          â”‚          â”‚                â”‚
   â”‚          â”‚          â”‚                â”‚
   X (cierra) â”‚          â”‚                â”‚
              â”‚          â”‚                â”‚
              â”‚          â”‚                â”‚ (Detecta
              â”‚          â”‚                â”‚  desconexiÃ³n)
              â”‚          â”‚                â”‚
              â”‚          â”‚                â”‚ (Actualiza
              â”‚          â”‚                â”‚  GestorSesiones)
              â”‚          â”‚                â”‚
              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ (Difunde
              â”‚  DTOResponse              â”‚  actualizaciÃ³n)
              â”‚  (actualizarListaContactos)
              â”‚                           â”‚
```

---

## Multi-threading y AsincronÃ­a

### Cliente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Hilo Principal                       â”‚
â”‚                   (JavaFX Thread)                       â”‚
â”‚                                                          â”‚
â”‚  â€¢ Renderiza la UI                                      â”‚
â”‚  â€¢ Captura eventos del usuario                          â”‚
â”‚  â€¢ Actualiza componentes visuales                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ CompletableFuture
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Hilo de LÃ³gica de Negocio                  â”‚
â”‚                                                          â”‚
â”‚  â€¢ Procesa peticiones                                   â”‚
â”‚  â€¢ EnvÃ­a al servidor                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Socket I/O
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Hilo del GestorRespuesta (Listener)             â”‚
â”‚                                                          â”‚
â”‚  â€¢ Lee continuamente del socket                         â”‚
â”‚  â€¢ Parsea JSON                                          â”‚
â”‚  â€¢ Invoca manejadores registrados                       â”‚
â”‚  â€¢ Completa CompletableFutures                          â”‚
â”‚                                                          â”‚
â”‚  while (!interrupted) {                                 â”‚
â”‚      String mensaje = in.readLine();                    â”‚
â”‚      procesarRespuesta(mensaje);                        â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Servidor

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Boss EventLoop                       â”‚
â”‚              (Acepta nuevas conexiones)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Worker EventLoops (Pool)                   â”‚
â”‚                                                          â”‚
â”‚  EventLoop 1  â”‚  EventLoop 2  â”‚  ...  â”‚  EventLoop N    â”‚
â”‚  â”œâ”€ Canal 1   â”‚  â”œâ”€ Canal 3   â”‚       â”‚  â”œâ”€ Canal N    â”‚
â”‚  â””â”€ Canal 2   â”‚  â””â”€ Canal 4   â”‚       â”‚                 â”‚
â”‚                                                          â”‚
â”‚  â€¢ Cada EventLoop maneja mÃºltiples canales              â”‚
â”‚  â€¢ Non-blocking I/O                                     â”‚
â”‚  â€¢ Procesa eventos en cola                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Escalabilidad y Rendimiento

### Cliente
- **Un hilo por cliente** para escuchar respuestas
- **CompletableFuture** para no bloquear la UI
- **Platform.runLater()** para actualizar UI de forma segura

### Servidor (Netty)
- **Event-driven** architecture
- **Non-blocking I/O** (NIO)
- **Thread pool** para workers
- Puede manejar **miles de conexiones** concurrentes
- Bajo overhead de memoria por conexiÃ³n

---

## Seguridad (Pendiente)

### Consideraciones Actuales
âš ï¸ **El servidor actual es para pruebas y NO es seguro para producciÃ³n:**

- âŒ Sin cifrado (texto plano)
- âŒ Sin validaciÃ³n de credenciales
- âŒ Sin autenticaciÃ³n robusta
- âŒ Sin protecciÃ³n contra ataques

### Mejoras Futuras
- âœ… Implementar TLS/SSL para cifrado
- âœ… Hash de contraseÃ±as (bcrypt)
- âœ… Tokens de autenticaciÃ³n (JWT)
- âœ… Rate limiting
- âœ… ValidaciÃ³n de entrada

---

## Resumen

El sistema Chat-Unillanos es un **sistema cliente-servidor robusto** con:

âœ… **SeparaciÃ³n de responsabilidades** clara  
âœ… **Arquitectura en capas** bien definida  
âœ… **Patrones de diseÃ±o** aplicados correctamente  
âœ… **ComunicaciÃ³n asÃ­ncrona** eficiente  
âœ… **Escalabilidad** mediante Netty  
âœ… **CÃ³digo mantenible** y modular  

Ideal para aprender sobre arquitectura de software, patrones de diseÃ±o y comunicaciÃ³n cliente-servidor.

