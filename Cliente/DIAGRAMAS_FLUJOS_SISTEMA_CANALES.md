# ğŸ“Š DIAGRAMAS Y FLUJOS DEL SISTEMA - GESTIÃ“N DE CANALES

## ğŸ“‹ Contenido
1. [Arquitectura en Capas](#arquitectura-en-capas)
2. [Flujo de Datos con Observer](#flujo-de-datos-con-observer)
3. [Ciclo de Vida de un Mensaje](#ciclo-de-vida-de-un-mensaje)
4. [Persistencia Local](#persistencia-local)
5. [GestiÃ³n de Errores](#gestiÃ³n-de-errores)

---

## ğŸ—ï¸ Arquitectura en Capas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CAPA DE PRESENTACIÃ“N                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ VentanaChatâ”‚  â”‚VentanaCanalâ”‚  â”‚Controladoresâ”‚            â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚             â”‚            â”‚
â”‚  â”‚ Implementa â”‚  â”‚ Implementa â”‚  â”‚ Implementa  â”‚            â”‚
â”‚  â”‚IObservador â”‚  â”‚IObservador â”‚  â”‚ IObservador â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚        â”‚               â”‚                â”‚                    â”‚
â”‚        â”‚ registrar()   â”‚ registrar()    â”‚ registrar()        â”‚
â”‚        â–¼               â–¼                â–¼                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        â”‚    CAPA DE NEGOCIO (ISujeto)   â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Gestor    â”‚  â”‚  Listador   â”‚  â”‚    Gestor     â”‚         â”‚
â”‚  â”‚  Mensajes  â”‚  â”‚  Canales    â”‚  â”‚Notificaciones â”‚         â”‚
â”‚  â”‚            â”‚  â”‚             â”‚  â”‚               â”‚         â”‚
â”‚  â”‚ notificar()â”‚  â”‚ notificar() â”‚  â”‚  notificar()  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚        â”‚              â”‚                    â”‚                 â”‚
â”‚        â”‚ guardar()    â”‚ sincronizar()      â”‚                 â”‚
â”‚        â–¼              â–¼                    â–¼                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        â”‚    CAPA DE PERSISTENCIA           â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   Repositorio   â”‚  â”‚   Repositorio    â”‚                  â”‚
â”‚  â”‚Mensaje Canal    â”‚  â”‚     Canal        â”‚                  â”‚
â”‚  â”‚                 â”‚  â”‚                  â”‚                  â”‚
â”‚  â”‚  CompletableFu- â”‚  â”‚  CompletableFu-  â”‚                  â”‚
â”‚  â”‚  ture<Boolean>  â”‚  â”‚  ture<List>      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                     â”‚                            â”‚
â”‚           â–¼                     â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚         Base de Datos H2 Local          â”‚                â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                â”‚
â”‚  â”‚  â”‚ canales  â”‚  â”‚ mensajes â”‚  â”‚usuariosâ”‚â”‚                â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              COMUNICACIÃ“N CON SERVIDOR                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚Enviador        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚     SERVIDOR    â”‚             â”‚
â”‚  â”‚Peticiones      â”‚  JSON   â”‚                 â”‚             â”‚
â”‚  â”‚                â”‚         â”‚                 â”‚             â”‚
â”‚  â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Notificaciones â”‚             â”‚
â”‚  â”‚                â”‚  JSON   â”‚      Push       â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚          â”‚                                                   â”‚
â”‚          â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚Gestor Respuestaâ”‚                                          â”‚
â”‚  â”‚                â”‚                                          â”‚
â”‚  â”‚ callbacks      â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚           â”‚ invoca manejador                                 â”‚
â”‚           â–¼                                                  â”‚
â”‚    Gestor de Negocio (manejarRespuesta)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”” Flujo de Datos con Observer

### Escenario: Nuevo Mensaje Recibido (Push del Servidor)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERVIDOR â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ 1. EnvÃ­a notificaciÃ³n push
     â”‚    {"action": "nuevoMensajeCanal", "data": {...}}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GestorRespuesta     â”‚
â”‚ (Capa ComunicaciÃ³n) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 2. Busca manejador registrado
           â”‚    para "nuevoMensajeCanal"
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GestorMensajesCanalImpl  â”‚
â”‚ .manejarNuevoMensaje()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 3. Convierte JSON a DTOMensajeCanal
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RepositorioMensajeCanal  â”‚
â”‚ .guardarMensajeRecibido()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 4. INSERT INTO mensaje_recibido_canal
           â”‚    (OperaciÃ³n asÃ­ncrona)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Base de Datos   â”‚
â”‚       H2         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 5. CompletableFuture<Boolean> = true
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GestorMensajesCanalImpl  â”‚
â”‚ .notificarObservadores() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 6. notificar("MENSAJE_CANAL_RECIBIDO", mensaje)
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼              â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Ventana   â”‚  â”‚Ventana   â”‚  â”‚Ventana   â”‚  â”‚Ventana   â”‚
    â”‚Chat 1    â”‚  â”‚Chat 2    â”‚  â”‚Canales   â”‚  â”‚Principal â”‚
    â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚
    â”‚.actualiz â”‚  â”‚.actualiz â”‚  â”‚.actualiz â”‚  â”‚.actualiz â”‚
    â”‚ar()      â”‚  â”‚ar()      â”‚  â”‚ar()      â”‚  â”‚ar()      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚             â”‚             â”‚
         â”‚ 7. Platform.runLater(() -> {
         â”‚       // Actualizar UI en hilo JavaFX
         â–¼       })
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  INTERFAZ DE USUARIO ACTUALIZADA            â”‚
    â”‚  â€¢ Nuevo mensaje aparece en el chat         â”‚
    â”‚  â€¢ Badge de notificaciÃ³n se actualiza       â”‚
    â”‚  â€¢ Sonido de notificaciÃ³n se reproduce      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¨ Ciclo de Vida de un Mensaje

### Enviar Mensaje de Texto

```
USUARIO                 UI                  NEGOCIO              PERSISTENCIA         SERVIDOR
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚ 1. Escribe mensaje  â”‚                      â”‚                      â”‚                   â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚ 2. Click "Enviar"   â”‚                      â”‚                      â”‚                   â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚ 3. enviarMensajeTexto(canalId, contenido)   â”‚                   â”‚
  â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚ 4. guardarMensajeEnviado()              â”‚
  â”‚                     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚                      â”‚ 5. INSERT INTO    â”‚
  â”‚                     â”‚                      â”‚                      â”‚    mensaje_enviadoâ”‚
  â”‚                     â”‚                      â”‚                      â”‚    _canal         â”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚ 6. CompletableFuture<Boolean> = true    â”‚
  â”‚                     â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚ 7. enviar(DTORequest)â”‚                   â”‚
  â”‚                     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚                      â”‚ 8. Procesa mensajeâ”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚ 9. DTOResponse("success")                â”‚
  â”‚                     â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚ 10. notificar("MENSAJE_ENVIADO_EXITOSO")    â”‚                   â”‚
  â”‚                     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚ 11. Mensaje enviado â”‚                      â”‚                      â”‚                   â”‚
  â”‚     UI actualizada  â”‚                      â”‚                      â”‚                   â”‚
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
  â”‚                     â”‚                      â”‚ 12. Servidor envÃ­a push a otros miembrosâ”‚
  â”‚                     â”‚                      â”‚                      â”‚                   â”‚
```

### Recibir Mensaje (Otros Usuarios)

```
SERVIDOR            NEGOCIO              PERSISTENCIA         UI                   USUARIO
   â”‚                   â”‚                      â”‚                 â”‚                      â”‚
   â”‚ 1. Push:          â”‚                      â”‚                 â”‚                      â”‚
   â”‚ nuevoMensajeCanal â”‚                      â”‚                 â”‚                      â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                 â”‚                      â”‚
   â”‚                   â”‚                      â”‚                 â”‚                      â”‚
   â”‚                   â”‚ 2. guardarMensajeRecibido()           â”‚                      â”‚
   â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚                      â”‚
   â”‚                   â”‚                      â”‚                 â”‚                      â”‚
   â”‚                   â”‚                      â”‚ 3. INSERT INTO  â”‚                      â”‚
   â”‚                   â”‚                      â”‚    mensaje_     â”‚                      â”‚
   â”‚                   â”‚                      â”‚    recibido_    â”‚                      â”‚
   â”‚                   â”‚                      â”‚    canal        â”‚                      â”‚
   â”‚                   â”‚                      â”‚                 â”‚                      â”‚
   â”‚                   â”‚ 4. true              â”‚                 â”‚                      â”‚
   â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                      â”‚
   â”‚                   â”‚                      â”‚                 â”‚                      â”‚
   â”‚                   â”‚ 5. notificar("MENSAJE_CANAL_RECIBIDO")â”‚                      â”‚
   â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚
   â”‚                   â”‚                      â”‚                 â”‚                      â”‚
   â”‚                   â”‚                      â”‚                 â”‚ 6. Agregar mensaje   â”‚
   â”‚                   â”‚                      â”‚                 â”‚    a ListView        â”‚
   â”‚                   â”‚                      â”‚                 â”‚                      â”‚
   â”‚                   â”‚                      â”‚                 â”‚ 7. Reproducir sonido â”‚
   â”‚                   â”‚                      â”‚                 â”‚                      â”‚
   â”‚                   â”‚                      â”‚                 â”‚ 8. Mostrar notif.    â”‚
   â”‚                   â”‚                      â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚                   â”‚                      â”‚                 â”‚                      â”‚
```

---

## ğŸ’¾ Persistencia Local

### Estrategia de SincronizaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ESTADO DEL SISTEMA                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CASO 1: CONEXIÃ“N NORMAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Paso 1: Servidor envÃ­a datos
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Servidor â”‚â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                 â”‚ {"action": "listarCanales", "data": [...]}
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Gestor Negocioâ”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Recibe: 3 canales
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Repositorio  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ sincronizarCanales([...])
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  BD Local H2  â”‚
         â”‚               â”‚
         â”‚ Antes: 2 canales
         â”‚ DespuÃ©s: 3 canales (actualizado)
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CASO 2: SIN CONEXIÃ“N (MODO OFFLINE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Paso 1: Usuario intenta enviar mensaje
â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚  UI  â”‚â”€â”€â”€â–¶ enviarMensaje("Hola")
â””â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Negocio    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Guarda localmente
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BD Local    â”‚
â”‚              â”‚
â”‚ estado: "pendiente"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Intenta enviar al servidor
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Servidor   â”‚ âœ— Sin conexiÃ³n
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Paso 2: Se recupera la conexiÃ³n
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BD Local    â”‚
â”‚              â”‚
â”‚ SELECT * FROM mensaje_enviado_canal
â”‚ WHERE estado = 'pendiente'
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Encuentra: 1 mensaje pendiente
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Sincron.   â”‚ ReenvÃ­a mensajes pendientes
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Servidor   â”‚ âœ“ ConexiÃ³n OK
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Confirma recepciÃ³n
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BD Local    â”‚
â”‚              â”‚
â”‚ UPDATE estado = 'enviado'
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ GestiÃ³n de Errores

### JerarquÃ­a de Manejo de Errores

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NIVEL 1: VALIDACIÃ“N EN UI                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ Campos vacÃ­os                                     â”‚   â”‚
â”‚  â”‚  â€¢ Formato incorrecto                                â”‚   â”‚
â”‚  â”‚  â€¢ Longitud excedida                                 â”‚   â”‚
â”‚  â”‚  â€¢ Canal no seleccionado                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚ Error: Mostrar alerta                            â”‚
â”‚          â”‚ OK: Continuar â–¼                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NIVEL 2: VALIDACIÃ“N EN NEGOCIO                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ Usuario no autenticado                            â”‚   â”‚
â”‚  â”‚  â€¢ SesiÃ³n expirada                                   â”‚   â”‚
â”‚  â”‚  â€¢ Permisos insuficientes                            â”‚   â”‚
â”‚  â”‚  â€¢ Datos inconsistentes                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚ Error: CompletableFuture.failedFuture()          â”‚
â”‚          â”‚        notificar("ERROR_OPERACION", ...)          â”‚
â”‚          â”‚ OK: Continuar â–¼                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NIVEL 3: PERSISTENCIA                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ Error de conexiÃ³n a BD                            â”‚   â”‚
â”‚  â”‚  â€¢ ViolaciÃ³n de constraint                           â”‚   â”‚
â”‚  â”‚  â€¢ Espacio insuficiente                              â”‚   â”‚
â”‚  â”‚  â€¢ Timeout                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚ Error: SQLException capturada                    â”‚
â”‚          â”‚        return false / CompletableFuture fail     â”‚
â”‚          â”‚ OK: Continuar â–¼                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NIVEL 4: COMUNICACIÃ“N                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ Servidor no responde                              â”‚   â”‚
â”‚  â”‚  â€¢ Timeout de red                                    â”‚   â”‚
â”‚  â”‚  â€¢ Respuesta con status "error"                      â”‚   â”‚
â”‚  â”‚  â€¢ JSON malformado                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚ Error: DTOResponse con status="error"            â”‚
â”‚          â”‚        Manejador invoca notificar error          â”‚
â”‚          â”‚ OK: DTOResponse status="success" â–¼               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Ã‰XITO      â”‚
    â”‚ UI Actualiza â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ejemplo de CÃ³digo Completo con Manejo de Errores

```java
public void enviarMensaje() {
    // NIVEL 1: ValidaciÃ³n UI
    if (canalSeleccionado == null) {
        mostrarAlerta("Selecciona un canal");
        return; // â† Sale aquÃ­ si hay error
    }
    
    String contenido = txtMensaje.getText().trim();
    if (contenido.isEmpty() || contenido.length() > 1000) {
        mostrarAlerta("Mensaje invÃ¡lido");
        return; // â† Sale aquÃ­ si hay error
    }
    
    // NIVEL 2-3-4: EnvÃ­o asÃ­ncrono
    gestorMensajes.enviarMensajeTexto(canalId, contenido)
        .thenAccept(resultado -> {
            // Ã‰XITO: El mensaje fue enviado
            Platform.runLater(() -> {
                txtMensaje.clear();
                System.out.println("âœ“ Mensaje enviado");
            });
        })
        .exceptionally(ex -> {
            // ERROR: Algo fallÃ³ en algÃºn nivel
            Platform.runLater(() -> {
                String mensaje;
                
                if (ex instanceof IllegalStateException) {
                    mensaje = "SesiÃ³n expirada";
                    redirigirALogin();
                } else if (ex instanceof SQLException) {
                    mensaje = "Error de base de datos local";
                } else {
                    mensaje = "Error: " + ex.getMessage();
                }
                
                mostrarAlerta(mensaje);
            });
            return null;
        });
}
```

---

## ğŸ“Š MÃ©tricas del Sistema

```
COMPONENTES CREADOS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ“ 3 DTOs nuevos (DTOMensajeCanal, DTOEnviarMensajeCanal, etc.)
âœ“ 2 Interfaces de repositorio (IRepositorioMensajeCanal)
âœ“ 1 ImplementaciÃ³n de repositorio (RepositorioMensajeCanalImpl)
âœ“ 2 Interfaces de negocio (IGestorMensajesCanal)
âœ“ 1 ImplementaciÃ³n de negocio (GestorMensajesCanalImpl)
âœ“ 1 Inicializador central (InicializadorGestionCanales)
âœ“ 3 Documentos completos con ejemplos

PERSISTENCIA:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ“ Operaciones asÃ­ncronas con CompletableFuture
âœ“ SincronizaciÃ³n bidireccional servidor-local
âœ“ Manejo de mensajes offline
âœ“ Queries optimizadas con Ã­ndices

PATRÃ“N OBSERVER:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ“ 7 tipos de notificaciones diferentes
âœ“ Thread-safe con CopyOnWriteArrayList
âœ“ IntegraciÃ³n con Platform.runLater de JavaFX
âœ“ Desregistro automÃ¡tico al cerrar ventanas

COMUNICACIÃ“N:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ“ 7 acciones documentadas con JSON completo
âœ“ Peticiones y respuestas estructuradas
âœ“ Notificaciones push del servidor
âœ“ Manejo de errores en mÃºltiples niveles
```

---

ğŸ“… **Ãšltima actualizaciÃ³n**: 16 de Octubre, 2025
ğŸ‘¨â€ğŸ’» **Sistema de GestiÃ³n de Canales - Chat Unillanos**

